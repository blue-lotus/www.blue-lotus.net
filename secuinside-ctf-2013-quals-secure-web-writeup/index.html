
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>secuinside CTF 2013 quals secure web writeup - blue-lotus</title>
  <meta name="author" content="blue-lotus">

  
  <meta name="description" content="This problem consists a so plugin and web application. H.Shao analyzes the so plugin, and found out it was acting as a WAF, intended to filter out &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.blue-lotus.net//secuinside-ctf-2013-quals-secure-web-writeup">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="blue-lotus" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <div id="header-inner">
    <span class="first"><a href="/">blue-lotus</a></span>
    <span><a href="/about">about</a></span>
    <span class="last"><a href="/atom.xml" title="subscribe via RSS">rss</a></span>
  </div>
</hgroup>

</header>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Secuinside CTF 2013 Quals Secure Web Writeup</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-02T00:00:00+08:00" pubdate data-updated="true">Jun 2<span>nd</span>, 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>This problem consists a so plugin and web application. H.Shao analyzes the so plugin, and found out it was acting as a WAF, intended to filter out dangerous actions</p>

<pre><code>  if ( strstr(haystack, "php") )//no php
  {
    ap_log_cerror("mod_dontwebhack300.c", 130, 3, 0, v13, "be my guest. lol xD");
    *v15 = 1;
  }
  haystack = strstr(haystack, "filename");//must have filename
  if ( !haystack )
    return 0;
  v9 = get_filename(haystack);
  ap_log_cerror("mod_dontwebhack300.c", 138, 3, 0, v13, v9);
  if ( *v15 == 1 || check_bad_php_string(v13, src) == 1 )// forbid dangerous functions
    return 120000;
</code></pre>

<p>Disallowed functions:</p>

<pre><code>v11 = "passthru";
v12 = "fpassthru";
v13 = "system";
v14 = "`";
v15 = "execl";
v16 = "open";
v17 = "popen";
v18 = "escapeshellcmd";
v19 = "eval";
v20 = "proc_open";
v21 = "get_contents";
</code></pre>

<p>However, some mistakes occurred in the server configuration, causing the WAF working abnormally, thus exposing the application to the outside, which means one can upload any php webshell with full functionalities to the server . Given the source code of upload page:</p>

<pre><code>$uploaddir = '/var/www/uploads/' . md5($_SERVER["REMOTE_ADDR"]) . '/';

if(is_dir($uploaddir) == false)
    mkdir($uploaddir);
$uploadfile = $uploaddir . basename($_FILES['data']['name']);

if (move_uploaded_file($_FILES['data']['tmp_name'], $uploadfile)) {
    echo "Success\n";
} else {
    print "failed\n";
}
</code></pre>

<p>We could figure out the uploaded directory is md5(client_ip). Then we uploaded a webshell and connect back a shell. We found the server had gcc installed with linux version 3.8.0.</p>

<p>We first thought we might need root, so we tried several local root exploit but failed, also we didn&#8217;t found many other teams&#8217; exploit, so this may not be a right way.</p>

<p>At this time the wandering aay found the home directory, and the flag file was just there&#8230; problem solved this way.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">hqdvista</span></span>

      








  


<time datetime="2013-06-02T00:00:00+08:00" pubdate data-updated="true">Jun 2<span>nd</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/writeup/'>writeup</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.blue-lotus.net//secuinside-ctf-2013-quals-secure-web-writeup/" data-via="" data-counturl="http://www.blue-lotus.net//secuinside-ctf-2013-quals-secure-web-writeup/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/secuinside-ctf-2013-quals-reader-writeup/" title="Previous Post: secuinside CTF 2013 quals reader writeup">&laquo; secuinside CTF 2013 quals reader writeup</a>
      
      
        <a class="basic-alignment right" href="/secuinside-ctf-quals-2013-bigfile-of-secret-writeup/" title="Next Post: secuinside CTF Quals 2013 bigfile of secret writeup">secuinside CTF Quals 2013 bigfile of secret writeup &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/asis-ctf-finals-2013-login/">ASIS CTF Finals 2013 Login</a>
      </li>
    
      <li class="post">
        <a href="/asis-ctf-memdump-writeup/">ASIS CTF Memdump Writeup</a>
      </li>
    
      <li class="post">
        <a href="/ufo-ctf-2013-reverse-keygenme-writeup/">UFO CTF 2013 Reverse &#8211; KeyGenMe Writeup</a>
      </li>
    
      <li class="post">
        <a href="/ufoctf2013-web100-flagstore/">UFOCTF2013 Web100 FlagStore</a>
      </li>
    
      <li class="post">
        <a href="/sigint-2013-crypto300-satisfaction/">SIGINT 2013 Crypto300 Satisfaction</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - blue-lotus -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bluelotus';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
